{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/robin/OneDrive/Desktop/colorcode/v0-ai-social-media-app/lib/mongodb.js"],"sourcesContent":["import { MongoClient } from \"mongodb\"\r\n\r\nconst options = {\r\n  maxPoolSize: 10,\r\n  serverSelectionTimeoutMS: 5000,\r\n  socketTimeoutMS: 45000,\r\n}\r\n\r\nlet client\r\nlet clientPromise\r\n\r\nfunction getClientPromise() {\r\n  const uri = process.env.MONGODB_URI\r\n\r\n  if (!uri) {\r\n    console.error(\"[v0] MONGODB_URI environment variable is not set\")\r\n    return null\r\n  }\r\n\r\n  if (clientPromise) return clientPromise\r\n\r\n  if (process.env.NODE_ENV === \"development\") {\r\n    if (!global._mongoClientPromise) {\r\n      client = new MongoClient(uri, options)\r\n      global._mongoClientPromise = client.connect()\r\n    }\r\n    clientPromise = global._mongoClientPromise\r\n  } else {\r\n    client = new MongoClient(uri, options)\r\n    clientPromise = client.connect()\r\n  }\r\n\r\n  return clientPromise\r\n}\r\n\r\nexport default getClientPromise\r\n\r\nexport async function getDb() {\r\n  const promise = getClientPromise()\r\n\r\n  if (!promise) {\r\n    throw new Error(\"MongoDB connection not configured. Please add MONGODB_URI to environment variables.\")\r\n  }\r\n\r\n  const client = await promise\r\n  return client.db(\"colorcode\")\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,UAAU;IACd,aAAa;IACb,0BAA0B;IAC1B,iBAAiB;AACnB;AAEA,IAAI;AACJ,IAAI;AAEJ,SAAS;IACP,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;IAEnC,IAAI,CAAC,KAAK;QACR,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IAEA,IAAI,eAAe,OAAO;IAE1B,wCAA4C;QAC1C,IAAI,CAAC,yDAAO,mBAAmB,EAAE;YAC/B,SAAS,IAAI,sHAAW,CAAC,KAAK;YAC9B,yDAAO,mBAAmB,GAAG,OAAO,OAAO;QAC7C;QACA,gBAAgB,yDAAO,mBAAmB;IAC5C;;IAKA,OAAO;AACT;uCAEe;AAER,eAAe;IACpB,MAAM,UAAU;IAEhB,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACnB"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/robin/OneDrive/Desktop/colorcode/v0-ai-social-media-app/lib/auth.js"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\"\r\nimport { cookies } from \"next/headers\"\r\nimport bcrypt from \"bcryptjs\"\r\n\r\nconst secret = new TextEncoder().encode(process.env.JWT_SECRET || \"colorcode-secret-key-2024\")\r\n\r\nexport async function hashPassword(password) {\r\n  return bcrypt.hash(password, 12)\r\n}\r\n\r\nexport async function verifyPassword(password, hashedPassword) {\r\n  return bcrypt.compare(password, hashedPassword)\r\n}\r\n\r\nexport async function createToken(payload) {\r\n  return new SignJWT(payload).setProtectedHeader({ alg: \"HS256\" }).setExpirationTime(\"7d\").sign(secret)\r\n}\r\n\r\nexport async function verifyToken(token) {\r\n  try {\r\n    const { payload } = await jwtVerify(token, secret)\r\n    return payload\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getSession() {\r\n  const cookieStore = await cookies()\r\n  const token = cookieStore.get(\"auth-token\")?.value\r\n  if (!token) return null\r\n  return verifyToken(token)\r\n}\r\n\r\nexport async function setSession(userId, email) {\r\n  const token = await createToken({ userId, email })\r\n  const cookieStore = await cookies()\r\n  cookieStore.set(\"auth-token\", token, {\r\n    httpOnly: true,\r\n    secure: process.env.NODE_ENV === \"production\",\r\n    sameSite: \"lax\",\r\n    maxAge: 60 * 60 * 24 * 7, // 7 days\r\n  })\r\n  return token\r\n}\r\n\r\nexport async function clearSession() {\r\n  const cookieStore = await cookies()\r\n  cookieStore.delete(\"auth-token\")\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE3D,eAAe,aAAa,QAAQ;IACzC,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAQ,EAAE,cAAc;IAC3D,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,YAAY,OAAO;IACvC,OAAO,IAAI,kKAAO,CAAC,SAAS,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAAG,iBAAiB,CAAC,MAAM,IAAI,CAAC;AAChG;AAEO,eAAe,YAAY,KAAK;IACrC,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAC7C,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,YAAY;AACrB;AAEO,eAAe,WAAW,MAAM,EAAE,KAAK;IAC5C,MAAM,QAAQ,MAAM,YAAY;QAAE;QAAQ;IAAM;IAChD,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/robin/OneDrive/Desktop/colorcode/v0-ai-social-media-app/app/api/reels/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { getDb } from \"@/lib/mongodb\"\r\nimport { getSession } from \"@/lib/auth\"\r\nimport { ObjectId } from \"mongodb\"\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const session = await getSession()\r\n    if (!session) {\r\n      return NextResponse.json({ success: false, error: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const { videoUrl, caption, thumbnail } = await request.json()\r\n\r\n    if (!videoUrl) {\r\n      return NextResponse.json({ success: false, error: \"Video URL required\" }, { status: 400 })\r\n    }\r\n\r\n    const db = await getDb()\r\n\r\n    const reel = {\r\n      _id: new ObjectId(),\r\n      userId: new ObjectId(session.userId),\r\n      videoUrl,\r\n      thumbnail: thumbnail || \"\",\r\n      caption: caption || \"\",\r\n      likes: [],\r\n      comments: [],\r\n      views: 0,\r\n      createdAt: new Date(),\r\n    }\r\n\r\n    await db.collection(\"reels\").insertOne(reel)\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      reel: {\r\n        ...reel,\r\n        _id: reel._id.toString(),\r\n        userId: reel.userId.toString(),\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Create reel error:\", error)\r\n    return NextResponse.json({ success: false, error: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const page = Number.parseInt(searchParams.get(\"page\") || \"1\")\r\n    const limit = Number.parseInt(searchParams.get(\"limit\") || \"10\")\r\n    const skip = (page - 1) * limit\r\n\r\n    const db = await getDb()\r\n\r\n    const reels = await db\r\n      .collection(\"reels\")\r\n      .aggregate([\r\n        { $sort: { createdAt: -1 } },\r\n        { $skip: skip },\r\n        { $limit: limit },\r\n        {\r\n          $lookup: {\r\n            from: \"users\",\r\n            localField: \"userId\",\r\n            foreignField: \"_id\",\r\n            as: \"user\",\r\n            pipeline: [{ $project: { name: 1, avatar: 1 } }],\r\n          },\r\n        },\r\n        { $unwind: \"$user\" },\r\n      ])\r\n      .toArray()\r\n\r\n    const serializedReels = reels.map((reel) => ({\r\n      ...reel,\r\n      _id: reel._id.toString(),\r\n      userId: reel.userId.toString(),\r\n      user: { ...reel.user, _id: reel.user._id.toString() },\r\n      likes: reel.likes.map((id) => id.toString()),\r\n    }))\r\n\r\n    return NextResponse.json({ success: true, reels: serializedReels })\r\n  } catch (error) {\r\n    console.error(\"Get reels error:\", error)\r\n    return NextResponse.json({ success: false, error: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2HAAU;QAChC,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3D,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,MAAM,KAAK,MAAM,IAAA,yHAAK;QAEtB,MAAM,OAAO;YACX,KAAK,IAAI,mHAAQ;YACjB,QAAQ,IAAI,mHAAQ,CAAC,QAAQ,MAAM;YACnC;YACA,WAAW,aAAa;YACxB,SAAS,WAAW;YACpB,OAAO,EAAE;YACT,UAAU,EAAE;YACZ,OAAO;YACP,WAAW,IAAI;QACjB;QAEA,MAAM,GAAG,UAAU,CAAC,SAAS,SAAS,CAAC;QAEvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,GAAG,IAAI;gBACP,KAAK,KAAK,GAAG,CAAC,QAAQ;gBACtB,QAAQ,KAAK,MAAM,CAAC,QAAQ;YAC9B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,WAAW;QACzD,MAAM,QAAQ,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,YAAY;QAC3D,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAE1B,MAAM,KAAK,MAAM,IAAA,yHAAK;QAEtB,MAAM,QAAQ,MAAM,GACjB,UAAU,CAAC,SACX,SAAS,CAAC;YACT;gBAAE,OAAO;oBAAE,WAAW,CAAC;gBAAE;YAAE;YAC3B;gBAAE,OAAO;YAAK;YACd;gBAAE,QAAQ;YAAM;YAChB;gBACE,SAAS;oBACP,MAAM;oBACN,YAAY;oBACZ,cAAc;oBACd,IAAI;oBACJ,UAAU;wBAAC;4BAAE,UAAU;gCAAE,MAAM;gCAAG,QAAQ;4BAAE;wBAAE;qBAAE;gBAClD;YACF;YACA;gBAAE,SAAS;YAAQ;SACpB,EACA,OAAO;QAEV,MAAM,kBAAkB,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;gBAC3C,GAAG,IAAI;gBACP,KAAK,KAAK,GAAG,CAAC,QAAQ;gBACtB,QAAQ,KAAK,MAAM,CAAC,QAAQ;gBAC5B,MAAM;oBAAE,GAAG,KAAK,IAAI;oBAAE,KAAK,KAAK,IAAI,CAAC,GAAG,CAAC,QAAQ;gBAAG;gBACpD,OAAO,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,KAAO,GAAG,QAAQ;YAC3C,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,OAAO;QAAgB;IACnE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}